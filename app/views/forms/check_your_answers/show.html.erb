<% set_page_title(form_title(form_name: @current_context.form.name, page_name: t('form.check_your_answers.title'), mode: @mode)) %>

<% content_for :back_link do %>
  <% if @back_link %>
    <%= link_to "Back", @back_link, class: "govuk-back-link" %>
  <% end %>
<% end %>

<div class="govuk-grid-row">
  <div class="<%= @full_width ? 'govuk-grid-column-full' : 'govuk-grid-column-two-thirds-from-desktop' %>">
    <h1 class="govuk-heading-l">Check your answers before submitting your form</h1>

    <%if @rows %>
      <%= govuk_summary_list(rows: @rows.map { |row|
        { key: row[:key],
          value: { text: format_paragraphs(row[:value][:text].present? ? row[:value][:text] : t('form.check_your_answers.not_completed')) },
          actions: row[:actions]
        } })
      %>
    <% end %>

    <%= form_with url: @form_submit_path do |form| %>

      <% if FeatureService.enabled?(:email_confirmations_enabled) %>
        <%= form.govuk_radio_buttons_fieldset(:send_confirmation, legend: { size: 'm', tag: 'h2', text: 'Do you want to get an email confirming your form has been submitted?'},
                                                                  hint: { text: "We'll only use this email to send a confirmation that your form's been successfully submitted. It will not contain a copy of your answers." }) do %>
          <%= form.govuk_radio_button :send_confirmation, 'true', label: { text: 'Yes' } do %>
            <%= form.govuk_text_field :confirmation_email_address, label: { text: 'What email address do you want us to send your confirmation to?' } %>
          <% end %>
          <%= form.govuk_radio_button :send_confirmation, 'false', label: { text: 'No' } %>
        <% end %>
      <% end %>

      <%if @current_context.form.declaration_text.present? %>
        <h2 class="govuk-heading-m govuk-!-margin-top-7">Declaration</h2>
        <%= simple_format(@current_context.form.declaration_text, class: 'govuk-body') %>
      <% end %>

      <%= form.hidden_field :notify_reference, id: 'notification-id', value: @notify_reference %>

      <%= form.govuk_submit(@current_context.form.declaration_text.present? ? t('form.check_your_answers.agree_and_submit') : t('form.check_your_answers.submit')) %>
    <% end %>
  </div>
</div>
